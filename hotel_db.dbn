{
 "cells": [
  {
   "kind": 1,
   "language": "markdown",
   "value": "### Saba Madadi 401222126",
   "metadata": {},
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE guest (\r\n    guest_id    SERIAL PRIMARY KEY,\r\n    name        VARCHAR(50) NOT NULL,\r\n    family      VARCHAR(50) NOT NULL,\r\n    national_id VARCHAR(20),\r\n    passport    VARCHAR(20),\r\n    birthdate   DATE NOT NULL,\r\n    email       VARCHAR(100) UNIQUE NOT NULL,\r\n    CONSTRAINT chk_guest_id\r\n        CHECK (national_id IS NOT NULL OR passport IS NOT NULL)\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE guest_address (\r\n    address_id SERIAL PRIMARY KEY,\r\n    guest_id   INT NOT NULL,\r\n    province   VARCHAR(50) NOT NULL,\r\n    city       VARCHAR(50) NOT NULL,\r\n    street     VARCHAR(100) NOT NULL,\r\n    plaque     VARCHAR(20) NOT NULL,\r\n    CONSTRAINT fk_guest_address\r\n        FOREIGN KEY (guest_id)\r\n        REFERENCES guest(guest_id)\r\n        ON DELETE CASCADE\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE guest_phone (\r\n    phone_id SERIAL PRIMARY KEY,\r\n    guest_id INT NOT NULL,\r\n    phone    VARCHAR(20) NOT NULL,\r\n    CONSTRAINT uq_guest_phone UNIQUE (guest_id, phone),\r\n    CONSTRAINT fk_guest_phone\r\n        FOREIGN KEY (guest_id)\r\n        REFERENCES guest(guest_id)\r\n        ON DELETE CASCADE\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE room (\r\n    room_id  INT PRIMARY KEY,\r\n    type     VARCHAR(30) NOT NULL,\r\n    capacity INT NOT NULL CHECK (capacity > 0),\r\n    price    NUMERIC(10,2) NOT NULL CHECK (price >= 0),\r\n    features VARCHAR(255),\r\n    floor    INT NOT NULL,\r\n    bed_type VARCHAR(30) NOT NULL,\r\n    smoking  BOOLEAN NOT NULL DEFAULT FALSE,\r\n    status   VARCHAR(20) NOT NULL,\r\n    CONSTRAINT chk_room_status\r\n        CHECK (status IN ('available','reserved','occupied','cleaning'))\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE employee (\r\n    emp_id       SERIAL PRIMARY KEY,\r\n    name         VARCHAR(50) NOT NULL,\r\n    family       VARCHAR(50) NOT NULL,\r\n    national_id  VARCHAR(20) UNIQUE NOT NULL,\r\n    birthdate    DATE NOT NULL,\r\n    position     VARCHAR(50) NOT NULL,\r\n    username     VARCHAR(50) UNIQUE NOT NULL,\r\n    password     VARCHAR(255) NOT NULL,\r\n    access_level INT NOT NULL CHECK (access_level BETWEEN 1 AND 5)\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE employee_phone (\r\n    phone_id SERIAL PRIMARY KEY,\r\n    emp_id   INT NOT NULL,\r\n    phone    VARCHAR(20) NOT NULL,\r\n    CONSTRAINT uq_employee_phone UNIQUE (emp_id, phone),\r\n    CONSTRAINT fk_employee_phone\r\n        FOREIGN KEY (emp_id)\r\n        REFERENCES employee(emp_id)\r\n        ON DELETE CASCADE\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE reservation (\r\n    res_id       SERIAL PRIMARY KEY,\r\n    guest_id     INT NOT NULL,\r\n    emp_id       INT NOT NULL,\r\n    check_in     DATE NOT NULL,\r\n    check_out    DATE NOT NULL,\r\n    booking_date TIMESTAMP NOT NULL DEFAULT NOW(),\r\n    num_people   INT NOT NULL CHECK (num_people > 0),\r\n    status       VARCHAR(20) NOT NULL,\r\n    total_cost   NUMERIC(10,2) NOT NULL CHECK (total_cost >= 0),\r\n    payment      NUMERIC(10,2) NOT NULL DEFAULT 0 CHECK (payment >= 0),\r\n    discount     NUMERIC(5,2) NOT NULL DEFAULT 0 CHECK (discount >= 0),\r\n    CONSTRAINT chk_reservation_dates\r\n        CHECK (check_out > check_in),\r\n    CONSTRAINT chk_res_status\r\n        CHECK (status IN ('active','canceled','finished')),\r\n    CONSTRAINT fk_res_guest\r\n        FOREIGN KEY (guest_id)\r\n        REFERENCES guest(guest_id),\r\n    CONSTRAINT fk_res_emp\r\n        FOREIGN KEY (emp_id)\r\n        REFERENCES employee(emp_id)\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE reservation_room (\r\n    res_id  INT NOT NULL,\r\n    room_id INT NOT NULL,\r\n    PRIMARY KEY (res_id, room_id),\r\n    CONSTRAINT fk_rr_res\r\n        FOREIGN KEY (res_id)\r\n        REFERENCES reservation(res_id)\r\n        ON DELETE CASCADE,\r\n    CONSTRAINT fk_rr_room\r\n        FOREIGN KEY (room_id)\r\n        REFERENCES room(room_id)\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "CREATE TABLE employee_guest (\r\n    emp_id   INT NOT NULL,\r\n    guest_id INT NOT NULL,\r\n    PRIMARY KEY (emp_id, guest_id),\r\n    CONSTRAINT fk_eg_emp\r\n        FOREIGN KEY (emp_id)\r\n        REFERENCES employee(emp_id)\r\n        ON DELETE CASCADE,\r\n    CONSTRAINT fk_eg_guest\r\n        FOREIGN KEY (guest_id)\r\n        REFERENCES guest(guest_id)\r\n        ON DELETE CASCADE\r\n);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO guest (name, family, national_id, birthdate, email)\r\nVALUES\r\n('Ali','Mohammadi','1000000001','1990-02-14','ali.mohammadi1@gmail.com'),\r\n('Sara','Ahmadi','1000000002','1992-07-03','sara.ahmadi2@gmail.com'),\r\n('Reza','Karimi','1000000003','1988-11-21','reza.karimi3@gmail.com'),\r\n('Maryam','Hosseini','1000000004','1995-05-09','maryam.hosseini4@gmail.com'),\r\n('Amir','Rahimi','1000000005','1991-12-30','amir.rahimi5@gmail.com'),\r\n('Narges','Ebrahimi','1000000006','1993-03-17','narges.ebrahimi6@gmail.com'),\r\n('Hassan','Jafari','1000000007','1987-09-01','hassan.jafari7@gmail.com'),\r\n('Elham','Ghasemi','1000000008','1996-01-26','elham.ghasemi8@gmail.com'),\r\n('Mehdi','Akbari','1000000009','1989-06-12','mehdi.akbari9@gmail.com'),\r\n('Parisa','Sadeghi','1000000010','1994-10-05','parisa.sadeghi10@gmail.com'),\r\n('Pouya','Mousavi','1000000011','1990-04-28','pouya.mousavi11@gmail.com'),\r\n('Yasmin','Bagheri','1000000012','1997-08-19','yasmin.bagheri12@gmail.com'),\r\n('Majid','Kazemi','1000000013','1986-02-07','majid.kazemi13@gmail.com'),\r\n('Atena','Nazari','1000000014','1998-12-11','atena.nazari14@gmail.com'),\r\n('Hamid','Sharifi','1000000015','1985-05-24','hamid.sharifi15@gmail.com'),\r\n('Shabnam','Soleimani','1000000016','1992-09-14','shabnam.soleimani16@gmail.com'),\r\n('Arman','Hashemi','1000000017','1991-01-03','arman.hashemi17@gmail.com'),\r\n('Negin','Yousefi','1000000018','1996-06-27','negin.yousefi18@gmail.com'),\r\n('Kian','Abedini','1000000019','1988-03-08','kian.abedini19@gmail.com'),\r\n('Roya','Zarei','1000000020','1993-11-29','roya.zarei20@gmail.com'),\r\n('Sina','Rostami','1000000021','1990-07-22','sina.rostami21@gmail.com'),\r\n('Mona','Heidari','1000000022','1995-02-15','mona.heidari22@gmail.com'),\r\n('Farzad','Fallah','1000000023','1987-10-09','farzad.fallah23@gmail.com'),\r\n('Shadi','Mahdavi','1000000024','1994-04-01','shadi.mahdavi24@gmail.com'),\r\n('Behnam','Rahmani','1000000025','1992-12-18','behnam.rahmani25@gmail.com'),\r\n('Leila','Abbasi','1000000026','1996-08-06','leila.abbasi26@gmail.com'),\r\n('Saeed','Rajabi','1000000027','1989-01-27','saeed.rajabi27@gmail.com'),\r\n('Zahra','Nasiri','1000000028','1997-05-13','zahra.nasiri28@gmail.com'),\r\n('Peyman','Habibi','1000000029','1986-09-30','peyman.habibi29@gmail.com'),\r\n('Hadis','Nikzad','1000000030','1998-03-02','hadis.nikzad30@gmail.com'),\r\n('Ramin','Jalali','1000000031','1991-06-10','ramin.jalali31@gmail.com'),\r\n('Shahrzad','Sohrabi','1000000032','1993-10-25','shahrzad.sohrabi32@gmail.com'),\r\n('Ashkan','Bahrami','1000000033','1988-02-20','ashkan.bahrami33@gmail.com'),\r\n('Aida','Saadati','1000000034','1995-07-07','aida.saadati34@gmail.com'),\r\n('Yousef','Majidi','1000000035','1987-12-01','yousef.majidi35@gmail.com'),\r\n('Sepideh','Amini','1000000036','1996-04-16','sepideh.amini36@gmail.com'),\r\n('Navid','Talebi','1000000037','1992-09-09','navid.talebi37@gmail.com'),\r\n('Mina','Dehghani','1000000038','1997-01-14','mina.dehghani38@gmail.com'),\r\n('Babak','Noori','1000000039','1989-05-28','babak.noori39@gmail.com'),\r\n('Taraneh','Zare','1000000040','1994-11-03','taraneh.zare40@gmail.com'),\r\n('Shayan','Mansouri','1000000041','1990-03-19','shayan.mansouri41@gmail.com'),\r\n('Kourosh','Kamali','1000000042','1986-08-21','kourosh.kamali42@gmail.com'),\r\n('Raha','Daneshvar','1000000043','1998-02-12','raha.daneshvar43@gmail.com'),\r\n('Soroush','Abdi','1000000044','1991-07-26','soroush.abdi44@gmail.com'),\r\n('Samira','Khodaii','1000000045','1995-12-08','samira.khodaii45@gmail.com'),\r\n('Aria','Motamedi','1000000046','1993-04-23','aria.motamedi46@gmail.com'),\r\n('Helia','Parsa','1000000047','1997-09-15','helia.parsa47@gmail.com'),\r\n('Kasra','Amjadi','1000000048','1988-06-02','kasra.amjadi48@gmail.com'),\r\n('Nika','Ghorbani','1000000049','1996-10-19','nika.ghorbani49@gmail.com'),\r\n('Omid','Shirazi','1000000050','1992-01-11','omid.shirazi50@gmail.com');",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO guest_phone (guest_id, phone)\r\nSELECT guest_id,\r\n       '09' || LPAD((guest_id * 137)::text, 9, '3')\r\nFROM guest\r\nORDER BY guest_id\r\nLIMIT 50;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO guest_address (guest_id, province, city, street, plaque)\r\nSELECT guest_id,\r\n       CASE WHEN guest_id % 5 = 0 THEN 'Tehran'\r\n            WHEN guest_id % 5 = 1 THEN 'Isfahan'\r\n            WHEN guest_id % 5 = 2 THEN 'Fars'\r\n            WHEN guest_id % 5 = 3 THEN 'Khorasan'\r\n            ELSE 'Gilan' END,\r\n       CASE WHEN guest_id % 5 = 0 THEN 'Tehran'\r\n            WHEN guest_id % 5 = 1 THEN 'Isfahan'\r\n            WHEN guest_id % 5 = 2 THEN 'Shiraz'\r\n            WHEN guest_id % 5 = 3 THEN 'Mashhad'\r\n            ELSE 'Rasht' END,\r\n       'Street ' || guest_id,\r\n       (guest_id % 50 + 1)::text\r\nFROM guest\r\nORDER BY guest_id\r\nLIMIT 50;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO room (room_id, type, capacity, price, features, floor, bed_type, smoking, status)\r\nSELECT\r\n  100 + gs,\r\n  CASE WHEN gs % 3 = 0 THEN 'Suite'\r\n       WHEN gs % 3 = 1 THEN 'Single'\r\n       ELSE 'Double' END,\r\n  CASE WHEN gs % 3 = 0 THEN 4\r\n       WHEN gs % 3 = 1 THEN 1\r\n       ELSE 2 END,\r\n  1500000 + (gs * 100000),\r\n  'TV,WiFi',\r\n  (gs % 5) + 1,\r\n  CASE WHEN gs % 2 = 0 THEN 'King' ELSE 'Twin' END,\r\n  (gs % 4 = 0),\r\n  'available'\r\nFROM generate_series(1,50) AS gs;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO employee (name, family, national_id, birthdate, position, username, password, access_level)\r\nVALUES\r\n('Sara','Ahmadi','EMP0000001','1990-01-10','Reception','emp1','pass1',2),\r\n('Ali','Karimi','EMP0000002','1988-05-22','Reception','emp2','pass2',2),\r\n('Maryam','Hosseini','EMP0000003','1992-09-14','Manager','emp3','pass3',4),\r\n('Reza','Rahimi','EMP0000004','1985-12-03','Reception','emp4','pass4',2),\r\n('Narges','Ghasemi','EMP0000005','1995-07-08','Support','emp5','pass5',1);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO reservation (guest_id, emp_id, check_in, check_out, num_people, status, total_cost, payment, discount)\r\nSELECT\r\n  gs,                   \r\n  (gs % 5) + 1,          \r\n  DATE '2025-01-01' + (gs * 2),\r\n  DATE '2025-01-03' + (gs * 2),\r\n  (gs % 4) + 1,\r\n  'active',\r\n  3000000 + gs * 150000,\r\n  0,\r\n  0\r\nFROM generate_series(1,50) AS gs;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO reservation_room (res_id, room_id)\r\nSELECT res_id,\r\n       100 + res_id\r\nFROM reservation\r\nORDER BY res_id\r\nLIMIT 50;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO employee_guest (emp_id, guest_id)\r\nSELECT (guest_id % 5) + 1 AS emp_id,\r\n       guest_id\r\nFROM guest\r\nORDER BY guest_id\r\nLIMIT 50;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 1,
   "language": "markdown",
   "value": "#### Select",
   "metadata": {},
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT guest_id, name, family, national_id, email\r\nFROM guest\r\nORDER BY guest_id\r\nLIMIT 10;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 1,
   "language": "markdown",
   "value": "#### Insert",
   "metadata": {},
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO guest (name, family, national_id, birthdate, email)\r\nVALUES ('David', 'Miller', '2000000001', '1993-06-11', 'david.miller@gmail.com');",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT * FROM guest\r\nWHERE email = 'david.miller@gmail.com';",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO reservation (guest_id, emp_id, check_in, check_out, num_people, status, total_cost)\r\nVALUES (51, 1, '2025-03-01', '2025-03-05', 2, 'active', 8000000);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "INSERT INTO reservation_room (res_id, room_id)\r\nVALUES (51, 120);",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT r.res_id, r.guest_id, rr.room_id\r\nFROM reservation r\r\nJOIN reservation_room rr ON rr.res_id = r.res_id\r\nWHERE r.res_id = 51;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 1,
   "language": "markdown",
   "value": "#### Update",
   "metadata": {},
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "UPDATE reservation\r\nSET payment = payment + 1500000\r\nWHERE res_id = 10;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT res_id, total_cost, payment, status\r\nFROM reservation\r\nWHERE res_id = 10;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "UPDATE guest\r\nSET email = 'alimoh@gmail.com'\r\nWHERE guest_id = 1;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT guest_id, name, family, email\r\nFROM guest\r\nWHERE guest_id = 1;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 1,
   "language": "markdown",
   "value": "#### Delete",
   "metadata": {},
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "DELETE FROM reservation\r\nWHERE res_id = 8;",
   "metadata": {
    "connectionName": "Postgres"
   },
   "outputs": []
  },
  {
   "kind": 2,
   "language": "sql",
   "value": "SELECT * FROM reservation;",
   "metadata": {
    "connectionName": "Postgress"
   },
   "outputs": []
  }
 ],
 "metadata": {}
}